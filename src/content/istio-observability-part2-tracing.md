---
title: "Istio Observability Part 2: ë¶„ì‚° íŠ¸ë ˆì´ì‹±ìœ¼ë¡œ ìš”ì²­ íë¦„ ì¶”ì í•˜ê¸°"
excerpt: "Jaegerë¥¼ í™œìš©í•œ ë¶„ì‚° íŠ¸ë ˆì´ì‹±ê³¼ í—¤ë” ì „íŒŒì˜ ì¤‘ìš”ì„±"
category: "kubernetes"
tags: ["istio", "observability", "tracing", "jaeger", "distributed-tracing", "kubernetes"]
series:
  name: "istio-observability"
  order: 2
date: "2025-12-19"
---

## ğŸ¯ ì‹œì‘í•˜ë©°

Part 1ì—ì„œ ë©”íŠ¸ë¦­ìœ¼ë¡œ "ë¬´ì—‡ì´ ì¼ì–´ë‚˜ëŠ”ê°€"ë¥¼ ë´¤ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì—ì„œëŠ” **"ìš”ì²­ì´ ì–´ë””ë¥¼ ê±°ì³ê°”ëŠ”ê°€"**ë¥¼ ì•„ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤.

![Why Distributed Tracing](/images/istio-observability/tracing-need.svg)

| ìƒí™© | ì„¤ëª… |
|------|------|
| ë¬¸ì œ | "ê²°ì œê°€ ëŠë ¤ìš”!" - ë©”íŠ¸ë¦­ë§Œìœ¼ë¡œëŠ” ì–´ë””ê°€ ëŠë¦°ì§€ ëª¨ë¦„ |
| í•´ê²° | ë¶„ì‚° íŠ¸ë ˆì´ì‹±ìœ¼ë¡œ ê° ì„œë¹„ìŠ¤ë³„ ì†Œìš” ì‹œê°„ í™•ì¸ |
| ê²°ê³¼ | Bank APIê°€ 2.3ì´ˆ â†’ ë²”ì¸ ë°œê²¬! |

í•™ìŠµí•˜ë©´ì„œ ê¶ê¸ˆí–ˆë˜ ê²ƒë“¤ì…ë‹ˆë‹¤:
- Traceì™€ Spanì€ ë¬´ì—‡ì¼ê¹Œ?
- Istioê°€ ìë™ìœ¼ë¡œ í•´ì£¼ëŠ” ê²ƒê³¼ ë‚´ê°€ í•´ì•¼ í•˜ëŠ” ê²ƒì€?
- í—¤ë” ì „íŒŒëŠ” ì™œ ì¤‘ìš”í• ê¹Œ?

---

## ğŸ’¡ ë¶„ì‚° íŠ¸ë ˆì´ì‹± ê°œë…

### Traceì™€ Span

![Trace and Span Structure](/images/istio-observability/trace-span-structure.svg)

| ê°œë… | ì„¤ëª… |
|------|------|
| Trace | í•˜ë‚˜ì˜ ìš”ì²­ì´ ì‹œìŠ¤í…œì„ í†µê³¼í•˜ëŠ” ì „ì²´ ì—¬ì • (ê³ ìœ  Trace ID) |
| Span | í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„ (Span ID, Parent Span ID, ì‹œì‘/ì¢…ë£Œ ì‹œê°„, íƒœê·¸) |

### íƒ€ì„ë¼ì¸ ë·°

```
ì‹œê°„ â†’
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
|                                                |
|  Span A (Frontend)                             |
|  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  |
|  0ms                                    350ms  |
|      |                                         |
|      Span B (API Gateway)                      |
|      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ        |
|      50ms                            350ms     |
|          |                                     |
|          Span C (Payment)                      |
|          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ            |
|          100ms                     350ms       |
|              |                                 |
|              Span D (Bank API)                 |
|              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              |
|              150ms               350ms         |
|                                                |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
```

---

## ğŸ”§ Istio íŠ¸ë ˆì´ì‹± ì„¤ì •

### Jaeger ì„¤ì¹˜

```bash
# Istio ì• ë“œì˜¨ìœ¼ë¡œ ì„¤ì¹˜
$ kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/addons/jaeger.yaml

# í™•ì¸
$ kubectl get pods -n istio-system -l app=jaeger

# ì ‘ì†
$ kubectl port-forward -n istio-system svc/tracing 16686:80

# ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:16686 ì ‘ì†
```

### ìƒ˜í”Œë§ ì„¤ì •

```yaml
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  meshConfig:
    defaultConfig:
      tracing:
        sampling: 100.0    # 100% ìƒ˜í”Œë§ (ê°œë°œí™˜ê²½)
        # sampling: 1.0    # 1% ìƒ˜í”Œë§ (í”„ë¡œë•ì…˜)
```

í”„ë¡œë•ì…˜ì—ì„œ 100%ëŠ” ì˜¤ë²„í—¤ë“œê°€ í¬ë¯€ë¡œ 1~10% ì •ë„ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

### Telemetry APIë¡œ ì„¤ì •

```yaml
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: tracing-config
  namespace: istio-system
spec:
  tracing:
  - providers:
    - name: jaeger
    randomSamplingPercentage: 10.0   # 10% ìƒ˜í”Œë§
```

---

## âš ï¸ í•µì‹¬: í—¤ë” ì „íŒŒ (Header Propagation)

**Istioê°€ ìë™ìœ¼ë¡œ í•˜ëŠ” ê²ƒ**:
- Span ìƒì„±
- Trace ID ìƒì„± (ì—†ìœ¼ë©´)
- ë©”íŠ¸ë¦­/ë¡œê·¸ ìˆ˜ì§‘

**ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•´ì•¼ í•˜ëŠ” ê²ƒ**:
- ë“¤ì–´ì˜¨ íŠ¸ë ˆì´ì‹± í—¤ë”ë¥¼ ë‚˜ê°€ëŠ” ìš”ì²­ì— ì „íŒŒ!

![Header Propagation](/images/istio-observability/header-propagation.svg)

| ìƒí™© | ê²°ê³¼ |
|------|------|
| í—¤ë” ì „íŒŒ ì•ˆ í•¨ | Traceê°€ ëŠê¹€ â†’ ê° ì„œë¹„ìŠ¤ê°€ ë³„ë„ Traceë¡œ ë¶„ë¦¬ |
| í—¤ë” ì „íŒŒí•¨ | Traceê°€ ì—°ê²°ë¨ â†’ í•˜ë‚˜ì˜ Traceë¡œ ì „ì²´ íë¦„ ì¶”ì  ê°€ëŠ¥ |

### ì „íŒŒí•´ì•¼ í•  í—¤ë” ëª©ë¡

```
# B3 í˜•ì‹ (Zipkin)
x-b3-traceid
x-b3-spanid
x-b3-parentspanid
x-b3-sampled
x-b3-flags

# W3C Trace Context
traceparent
tracestate

# Istio/Envoy ì¶”ê°€ í—¤ë”
x-request-id
x-ot-span-context

# ê¶Œì¥: ëª¨ë‘ ì „íŒŒ
```

### ì–¸ì–´ë³„ í—¤ë” ì „íŒŒ êµ¬í˜„

#### Go

```go
func handler(w http.ResponseWriter, r *http.Request) {
    // ì „íŒŒí•  í—¤ë”ë“¤
    headers := []string{
        "x-request-id",
        "x-b3-traceid",
        "x-b3-spanid",
        "x-b3-parentspanid",
        "x-b3-sampled",
        "x-b3-flags",
        "traceparent",
        "tracestate",
    }

    // ì™¸ë¶€ ì„œë¹„ìŠ¤ í˜¸ì¶œ ì‹œ í—¤ë” ì „íŒŒ
    client := &http.Client{}
    req, _ := http.NewRequest("GET", "http://backend/api", nil)

    for _, h := range headers {
        if value := r.Header.Get(h); value != "" {
            req.Header.Set(h, value)
        }
    }

    resp, err := client.Do(req)
    // ...
}
```

#### Python (Flask)

```python
from flask import Flask, request
import requests

app = Flask(__name__)

TRACE_HEADERS = [
    'x-request-id',
    'x-b3-traceid',
    'x-b3-spanid',
    'x-b3-parentspanid',
    'x-b3-sampled',
    'x-b3-flags',
    'traceparent',
    'tracestate',
]

@app.route('/api/process')
def process():
    # í—¤ë” ì „íŒŒ
    headers = {h: request.headers.get(h)
               for h in TRACE_HEADERS
               if request.headers.get(h)}

    # ì™¸ë¶€ ì„œë¹„ìŠ¤ í˜¸ì¶œ
    response = requests.get('http://backend/api', headers=headers)
    return response.json()
```

#### Java (Spring)

```java
@RestController
public class ApiController {

    private static final List<String> TRACE_HEADERS = Arrays.asList(
        "x-request-id",
        "x-b3-traceid",
        "x-b3-spanid",
        "x-b3-parentspanid",
        "x-b3-sampled",
        "x-b3-flags",
        "traceparent",
        "tracestate"
    );

    @Autowired
    private RestTemplate restTemplate;

    @GetMapping("/api/process")
    public ResponseEntity<String> process(HttpServletRequest request) {
        HttpHeaders headers = new HttpHeaders();

        // í—¤ë” ì „íŒŒ
        TRACE_HEADERS.forEach(h -> {
            String value = request.getHeader(h);
            if (value != null) {
                headers.add(h, value);
            }
        });

        HttpEntity<String> entity = new HttpEntity<>(headers);
        return restTemplate.exchange(
            "http://backend/api",
            HttpMethod.GET,
            entity,
            String.class
        );
    }
}
```

#### Node.js (Express)

```javascript
const express = require('express');
const axios = require('axios');

const app = express();

const TRACE_HEADERS = [
    'x-request-id',
    'x-b3-traceid',
    'x-b3-spanid',
    'x-b3-parentspanid',
    'x-b3-sampled',
    'x-b3-flags',
    'traceparent',
    'tracestate',
];

app.get('/api/process', async (req, res) => {
    // í—¤ë” ì „íŒŒ
    const headers = {};
    TRACE_HEADERS.forEach(h => {
        if (req.headers[h.toLowerCase()]) {
            headers[h] = req.headers[h.toLowerCase()];
        }
    });

    // ì™¸ë¶€ ì„œë¹„ìŠ¤ í˜¸ì¶œ
    const response = await axios.get('http://backend/api', { headers });
    res.json(response.data);
});
```

---

## ğŸ“Š Jaeger UI í™œìš©

### ê¸°ë³¸ í™”ë©´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Jaeger UI                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Service: [frontend â–¼]    Operation: [all â–¼]                   â”‚
â”‚   Lookback: [Last Hour â–¼]  Limit: [20]                          â”‚
â”‚                                                                 â”‚
â”‚   [Find Traces]                                                 â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Traces                                                 â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚  â— abc123  frontend â†’ api â†’ payment    350ms   3 spans  â”‚   â”‚
â”‚   â”‚  â— def456  frontend â†’ api              150ms   2 spans  â”‚   â”‚
â”‚   â”‚  â— ghi789  frontend â†’ api â†’ payment    1.2s    3 spans  â”‚   â”‚
â”‚   â”‚            â†’ bank-api                          4 spans  â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ê²€ìƒ‰ íŒ¨ë„ ì´í•´í•˜ê¸°**

**Service ë“œë¡­ë‹¤ìš´**ì—ì„œ ë¶„ì„í•˜ê³  ì‹¶ì€ ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. Istio í™˜ê²½ì—ì„œëŠ” ëª¨ë“  sidecarê°€ ìˆëŠ” ì„œë¹„ìŠ¤ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. "istio-ingressgateway"ë¥¼ ì„ íƒí•˜ë©´ ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¨ ëª¨ë“  ìš”ì²­ì„ ë³¼ ìˆ˜ ìˆê³ , íŠ¹ì • ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•˜ë©´ ê·¸ ì„œë¹„ìŠ¤ê°€ ì°¸ì—¬í•œ Traceë§Œ í•„í„°ë§ë©ë‹ˆë‹¤.

**Operation**ì€ í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. "GET /api/users"ì²˜ëŸ¼ HTTP method + path í˜•íƒœë¡œ í‘œì‹œë©ë‹ˆë‹¤. "all"ì„ ì„ íƒí•˜ë©´ ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë´…ë‹ˆë‹¤.

**Lookback**ì€ ê²€ìƒ‰ ì‹œê°„ ë²”ìœ„ì…ë‹ˆë‹¤. ì¥ì• ê°€ "30ë¶„ ì „ì— ë°œìƒí–ˆë‹¤"ê³  ë³´ê³ ë°›ì•˜ë‹¤ë©´, "Last Hour"ë¡œ ì„¤ì •í•˜ê³  ê²€ìƒ‰í•©ë‹ˆë‹¤. ë„ˆë¬´ ë„“ì€ ë²”ìœ„ëŠ” ê²°ê³¼ê°€ ë§ì•„ì ¸ ë¶„ì„ì´ ì–´ë µìŠµë‹ˆë‹¤.

**ê²°ê³¼ ëª©ë¡**ì—ì„œ ê° ì¤„ì€ í•˜ë‚˜ì˜ Traceì…ë‹ˆë‹¤. "frontend â†’ api â†’ payment"ëŠ” ìš”ì²­ì´ ê±°ì³ê°„ ì„œë¹„ìŠ¤ ì²´ì¸ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. **ì‹œê°„(350ms)**ê³¼ **Span ìˆ˜(3 spans)**ëŠ” ì¤‘ìš”í•œ ì§€í‘œì…ë‹ˆë‹¤. ê°™ì€ ê²½ë¡œì¸ë° ì‹œê°„ ì°¨ì´ê°€ í¬ë‹¤ë©´, ëŠë¦° Traceë¥¼ í´ë¦­í•´ì„œ ì›ì¸ì„ íŒŒì•…í•©ë‹ˆë‹¤.

### Trace ìƒì„¸ í™”ë©´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Trace abc123                                     Total: 350ms â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   frontend [GET /checkout]                                      â”‚
â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  350ms   â”‚
â”‚   â”‚                                                             â”‚
â”‚   â””â”€â”€ api-gateway [POST /api/order]                             â”‚
â”‚       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      300ms   â”‚
â”‚       â”‚                                                         â”‚
â”‚       â”œâ”€â”€ payment [processPayment]                              â”‚
â”‚       â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ            250ms   â”‚
â”‚       â”‚   â”‚                                                     â”‚
â”‚       â”‚   â””â”€â”€ bank-api [POST /charge]                           â”‚
â”‚       â”‚       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              200ms   â”‚
â”‚       â”‚                                                         â”‚
â”‚       â””â”€â”€ inventory [checkStock]                                â”‚
â”‚           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                         50ms   â”‚
â”‚                                                                 â”‚
â”‚   Tags:                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ http.method: POST                                     â”‚     â”‚
â”‚   â”‚ http.url: /api/order                                  â”‚     â”‚
â”‚   â”‚ http.status_code: 200                                 â”‚     â”‚
â”‚   â”‚ node_id: sidecar~10.1.2.3~api-gateway-xxx             â”‚     â”‚
â”‚   â”‚ upstream_cluster: outbound|80||payment.default...     â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì›Œí„°í´ ë‹¤ì´ì–´ê·¸ë¨ ì½ê¸°**

Trace ìƒì„¸ í™”ë©´ì˜ í•µì‹¬ì€ **ì›Œí„°í´ ë‹¤ì´ì–´ê·¸ë¨**ì…ë‹ˆë‹¤. ê°€ë¡œ ë§‰ëŒ€ì˜ ê¸¸ì´ê°€ í•´ë‹¹ Spanì˜ ì†Œìš” ì‹œê°„ì…ë‹ˆë‹¤. ìœ„ ì˜ˆì‹œì—ì„œ ê°€ì¥ ê¸´ ë§‰ëŒ€ëŠ” bank-api(200ms)ì…ë‹ˆë‹¤. ì „ì²´ 350ms ì¤‘ 57%ê°€ ì—¬ê¸°ì„œ ì†Œë¹„ëœ ê²ƒì…ë‹ˆë‹¤.

**ë“¤ì—¬ì“°ê¸°**ëŠ” í˜¸ì¶œ ê´€ê³„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. frontendê°€ api-gatewayë¥¼ í˜¸ì¶œí•˜ê³ , api-gatewayê°€ paymentì™€ inventoryë¥¼ í˜¸ì¶œí•˜ëŠ” êµ¬ì¡°ê°€ í•œëˆˆì— ë³´ì…ë‹ˆë‹¤. ê°™ì€ ë ˆë²¨ì˜ ë“¤ì—¬ì“°ê¸°(paymentì™€ inventory)ëŠ” ë³‘ë ¬ í˜¸ì¶œì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

**ì‹œê°„ ë¶„ì„**: ì „ì²´ 350ms ì¤‘ api-gatewayê°€ 300msë¥¼ ì°¨ì§€í•˜ì§€ë§Œ, ê·¸ ì•ˆì—ì„œ payment(250ms)ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. "ìì²´ ì²˜ë¦¬ ì‹œê°„"ì€ 300 - 250 = 50msì…ë‹ˆë‹¤. ë§Œì•½ ìì²´ ì²˜ë¦¬ ì‹œê°„ì´ ë¹„ì •ìƒì ìœ¼ë¡œ ê¸¸ë‹¤ë©´, í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ ë¡œì§ì´ë‚˜ DB ì¿¼ë¦¬ë¥¼ ì ê²€í•´ì•¼ í•©ë‹ˆë‹¤.

**Tags ì„¹ì…˜**ì€ ê° Spanì˜ ë©”íƒ€ë°ì´í„°ì…ë‹ˆë‹¤. http.status_code=200ì´ë©´ ì„±ê³µ, 500ì´ë©´ ì—ëŸ¬ì…ë‹ˆë‹¤. upstream_clusterëŠ” Envoyê°€ ìš”ì²­ì„ ë³´ë‚¸ ëª©ì ì§€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. node_idëŠ” ì–´ë–¤ Podì˜ sidecarì—ì„œ ìƒì„±ëœ Spanì¸ì§€ ì•Œë ¤ì¤ë‹ˆë‹¤.

---

## ğŸ› ï¸ ì‹¤ì „ ë””ë²„ê¹…

### ëŠë¦° ìš”ì²­ ì°¾ê¸°

```
1. Jaegerì—ì„œ Service ì„ íƒ
2. Lookback: Last Hour
3. Min Duration: 1s (ëŠë¦° ìš”ì²­ë§Œ)
4. Find Traces

ê²°ê³¼ì—ì„œ ë³‘ëª© ì§€ì  í™•ì¸:
- ì–´ë–¤ Spanì´ ê°€ì¥ ì˜¤ë˜ ê±¸ë¦¬ëŠ”ê°€?
- íŠ¹ì • ì„œë¹„ìŠ¤ì—ì„œ ì¼ê´€ë˜ê²Œ ëŠë¦°ê°€?
```

**ì‹¤ì œ ë¶„ì„ ì˜ˆì‹œ**: "ê²°ì œê°€ ëŠë ¤ìš”!"ë¼ëŠ” ë³´ê³ ë¥¼ ë°›ì•˜ë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.

1. Service: "payment-service" ì„ íƒ, Min Duration: 2së¡œ ì„¤ì •
2. ëŠë¦° Trace 3-4ê°œë¥¼ í´ë¦­í•´ì„œ íŒ¨í„´ì„ ì°¾ìŠµë‹ˆë‹¤
3. ê³µí†µì  ë°œê²¬: bank-api Spanì´ í•­ìƒ 2ì´ˆ ì´ìƒ
4. Tags í™•ì¸: upstream_clusterê°€ "outbound|443||bank.external.com"
5. ê²°ë¡ : ì™¸ë¶€ ì€í–‰ API ì‘ë‹µì´ ëŠë¦¼ â†’ íƒ€ì„ì•„ì›ƒ ì„¤ì •ì´ë‚˜ ìºì‹± ê²€í† 

ë§Œì•½ ëŠë¦° Traceë§ˆë‹¤ ë³‘ëª© ìœ„ì¹˜ê°€ ë‹¤ë¥´ë‹¤ë©´, íŠ¹ì • Podì˜ ë¬¸ì œ(CPU throttling, GC)ì´ê±°ë‚˜ ë„¤íŠ¸ì›Œí¬ ì´ìŠˆì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. node_id íƒœê·¸ë¡œ ì–´ë–¤ Podì¸ì§€ í™•ì¸í•˜ì„¸ìš”.

### ì—ëŸ¬ ì¶”ì 

```
1. Tags ê²€ìƒ‰: error=true
2. ë˜ëŠ” Tags: http.status_code=500

ì—ëŸ¬ Spanì—ì„œ í™•ì¸:
- ì–´ë””ì„œ ì—ëŸ¬ê°€ ì‹œì‘ëëŠ”ê°€?
- ì—ëŸ¬ ë©”ì‹œì§€ëŠ”?
- ì—ëŸ¬ ë°œìƒ ì§ì „ ìƒí™©ì€?
```

**ì—ëŸ¬ Trace ë¶„ì„ íŒ**: ì—ëŸ¬ê°€ ë°œìƒí•œ Spanì„ ì°¾ìœ¼ë©´ ê·¸ **ì§ì „ Span**ì„ ì£¼ëª©í•˜ì„¸ìš”. ì˜ˆë¥¼ ë“¤ì–´, paymentì—ì„œ 503 ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ë©´, ê·¸ ì§ì „ì˜ api-gateway Spanì—ì„œ ì¬ì‹œë„ íšŸìˆ˜ë‚˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •ì„ í™•ì¸í•©ë‹ˆë‹¤. Logs íƒ­ì´ ìˆë‹¤ë©´ ì—ëŸ¬ ìŠ¤íƒíŠ¸ë ˆì´ìŠ¤ë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¹„êµ ë¶„ì„

```
1. ëŠë¦° Traceì™€ ë¹ ë¥¸ Trace ë¹„êµ
2. ì°¨ì´ì :
   - ì¶”ê°€ í˜¸ì¶œì´ ìˆëŠ”ê°€?
   - íŠ¹ì • ì„œë¹„ìŠ¤ê°€ ë” ëŠë¦°ê°€?
   - ì¬ì‹œë„ê°€ ë°œìƒí–ˆëŠ”ê°€?
```

Jaeger UIì—ì„œ ë‘ Traceë¥¼ ë¹„êµí•˜ë ¤ë©´, ê°ê°ì„ ìƒˆ íƒ­ì—ì„œ ì—´ê³  ë‚˜ë€íˆ ë´…ë‹ˆë‹¤. Span ìˆ˜ê°€ ë‹¤ë¥´ë‹¤ë©´ ì¬ì‹œë„ë‚˜ ì¶”ê°€ í˜¸ì¶œì´ ìˆì—ˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. ê°™ì€ Spanì¸ë° ì‹œê°„ì´ 10ë°° ì°¨ì´ ë‚˜ë©´, í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ ìƒíƒœë¥¼ ì ê²€í•˜ì„¸ìš”.

### í—¤ë” ì „íŒŒ ì‹¤íŒ¨ ë””ë²„ê¹…

Traceê°€ ëŠì–´ì ¸ ë³´ì¸ë‹¤ë©´ í—¤ë” ì „íŒŒ ë¬¸ì œì…ë‹ˆë‹¤. í™•ì¸ ë°©ë²•:

**ì¦ìƒ**: frontendì—ì„œ ì‹œì‘í•œ ìš”ì²­ì´ api-gatewayê¹Œì§€ë§Œ ë³´ì´ê³ , payment Spanì´ ë³„ë„ Traceë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬ë©´ ì „ì²´ íë¦„ ë¶„ì„ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.

**ì§„ë‹¨ 1: Jaegerì—ì„œ í™•ì¸**
```
1. ë‘ Traceì˜ ì‹œê°„ëŒ€ê°€ ê±°ì˜ ê°™ì€ì§€ í™•ì¸
2. ì²« ë²ˆì§¸ Traceì˜ ë§ˆì§€ë§‰ Span ì‹œê°„ê³¼ ë‘ ë²ˆì§¸ Traceì˜ ì‹œì‘ ì‹œê°„ì´ ì¼ì¹˜í•˜ë©´
   â†’ í—¤ë” ì „íŒŒ ì‹¤íŒ¨ í™•ì •
```

**ì§„ë‹¨ 2: í—¤ë” í™•ì¸**
```bash
# í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ ë¡œê·¸ì—ì„œ ë“¤ì–´ì˜¤ëŠ” í—¤ë” ì¶œë ¥
$ kubectl logs deploy/api-gateway -c istio-proxy | grep x-b3-traceid

# ë‚˜ê°€ëŠ” ìš”ì²­ì— í—¤ë”ê°€ ìˆëŠ”ì§€ í™•ì¸
$ kubectl logs deploy/api-gateway -c api-gateway | grep -i "x-b3\|traceparent"
```

**í•´ê²° ë°©ë²•**:
1. í•´ë‹¹ ì„œë¹„ìŠ¤ ì½”ë“œì—ì„œ í—¤ë” ì „íŒŒ ë¡œì§ì´ ìˆëŠ”ì§€ í™•ì¸
2. íŠ¹íˆ ë¹„ë™ê¸° í˜¸ì¶œ, ìŠ¤ë ˆë“œ í’€, ë©”ì‹œì§€ í ì²˜ë¦¬ ë¶€ë¶„ ì ê²€
3. ë¼ì´ë¸ŒëŸ¬ë¦¬(OpenTelemetry, Jaeger Client) ì‚¬ìš© ì‹œ ì„¤ì • í™•ì¸

**í”í•œ ì‹¤ìˆ˜**:
- HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ë©´ì„œ í—¤ë” ë³µì‚¬ë¥¼ ëˆ„ë½
- async/await í•¨ìˆ˜ì—ì„œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì „ë‹¬í•˜ì§€ ì•ŠìŒ
- ë©”ì‹œì§€ í(Kafka, RabbitMQ)ë¡œ ë³´ë‚¼ ë•Œ í—¤ë”ë¥¼ ë©”ì‹œì§€ í—¤ë”ë¡œ ë³€í™˜í•˜ì§€ ì•ŠìŒ

---

## âš™ï¸ ê³ ê¸‰ ì„¤ì •

### ì»¤ìŠ¤í…€ íƒœê·¸ ì¶”ê°€

```yaml
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: custom-tags
  namespace: default
spec:
  tracing:
  - customTags:
      my_custom_tag:
        header:
          name: x-custom-header
          defaultValue: "unknown"
      user_id:
        header:
          name: x-user-id
```

### íŠ¹ì • ê²½ë¡œ ìƒ˜í”Œë§ ì¡°ì ˆ

```yaml
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: selective-tracing
  namespace: default
spec:
  selector:
    matchLabels:
      app: payment-service
  tracing:
  - randomSamplingPercentage: 100.0   # ê²°ì œëŠ” 100%
---
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: health-no-trace
  namespace: default
spec:
  tracing:
  - disableSpanReporting: true
    match:
      mode: SERVER
  # /health, /metricsëŠ” íŠ¸ë ˆì´ì‹± ì œì™¸
```

---

## ğŸ“ˆ íŠ¸ë ˆì´ì‹± ë©”íŠ¸ë¦­

Jaeger ìì²´ë„ ë©”íŠ¸ë¦­ì„ ì œê³µí•©ë‹ˆë‹¤:

```promql
# Span ì²˜ë¦¬ëŸ‰
sum(rate(jaeger_spans_received_total[5m])) by (svc)

# ìƒ˜í”Œë§ëœ Span ìˆ˜
sum(rate(jaeger_spans_sampled_total[5m]))

# íŠ¸ë ˆì´ìŠ¤ ì €ì¥ ì§€ì—°
histogram_quantile(0.99,
  sum(rate(jaeger_span_storage_latency_bucket[5m])) by (le)
)
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ìƒ˜í”Œë§ ë¹„ìœ¨

```yaml
# ê°œë°œí™˜ê²½: 100% OK
sampling: 100.0

# í”„ë¡œë•ì…˜: 1-10% ê¶Œì¥
sampling: 1.0    # 1%
# ë˜ëŠ”
sampling: 10.0   # 10%

# ì´ìœ :
# - ë„¤íŠ¸ì›Œí¬ ì˜¤ë²„í—¤ë“œ
# - ì €ì¥ ê³µê°„
# - ì²˜ë¦¬ ë¹„ìš©
```

### 2. í—¤ë” ì „íŒŒ ëˆ„ë½

ê°€ì¥ í”í•œ ì‹¤ìˆ˜ì…ë‹ˆë‹¤. Traceê°€ ëŠê¸°ë©´:
1. ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì˜ í—¤ë” í™•ì¸
2. ë‚˜ê°€ëŠ” ìš”ì²­ì— í—¤ë” ë³µì‚¬ í™•ì¸
3. ëª¨ë“  ì™¸ë¶€ í˜¸ì¶œì— ì ìš©ëëŠ”ì§€ í™•ì¸

### 3. ë¹„ë™ê¸° ì²˜ë¦¬

```go
// âŒ ë¹„ë™ê¸°ì—ì„œ í—¤ë” ì „íŒŒ ëˆ„ë½
go func() {
    // ì»¨í…ìŠ¤íŠ¸/í—¤ë” ì—†ì´ í˜¸ì¶œ
    client.Call("http://service/api")
}()

// âœ… ì»¨í…ìŠ¤íŠ¸ ì „ë‹¬
go func(headers map[string]string) {
    req, _ := http.NewRequest("GET", "http://service/api", nil)
    for k, v := range headers {
        req.Header.Set(k, v)
    }
    client.Do(req)
}(extractHeaders(originalRequest))
```

---

## ğŸ“š ì •ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ë¶„ì‚° íŠ¸ë ˆì´ì‹± ì²´í¬ë¦¬ìŠ¤íŠ¸                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   âœ… ì¸í”„ë¼ ì„¤ì •                                                â”‚
â”‚      â–¡ Jaeger ì„¤ì¹˜                                              â”‚
â”‚      â–¡ ìƒ˜í”Œë§ ë¹„ìœ¨ ì„¤ì • (í”„ë¡œë•ì…˜ 1-10%)                        â”‚
â”‚      â–¡ ì €ì¥ ê¸°ê°„ ì„¤ì •                                           â”‚
â”‚                                                                 â”‚
â”‚   âœ… ì• í”Œë¦¬ì¼€ì´ì…˜ (í•„ìˆ˜!)                                       â”‚
â”‚      â–¡ íŠ¸ë ˆì´ì‹± í—¤ë” ì „íŒŒ êµ¬í˜„                                  â”‚
â”‚      â–¡ ëª¨ë“  ì™¸ë¶€ í˜¸ì¶œì— ì ìš©                                    â”‚
â”‚      â–¡ ë¹„ë™ê¸° í˜¸ì¶œë„ í™•ì¸                                       â”‚
â”‚                                                                 â”‚
â”‚   âœ… ìš´ì˜                                                       â”‚
â”‚      â–¡ ëŠë¦° ìš”ì²­ ëª¨ë‹ˆí„°ë§                                       â”‚
â”‚      â–¡ ì—ëŸ¬ íŠ¸ë ˆì´ìŠ¤ ë¶„ì„                                       â”‚
â”‚      â–¡ ì„œë¹„ìŠ¤ ì˜ì¡´ì„± íŒŒì•…                                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ í•µì‹¬ ì •ë¦¬

| ê°œë… | ì„¤ëª… |
|------|------|
| **Trace** | í•˜ë‚˜ì˜ ìš”ì²­ì´ ì‹œìŠ¤í…œì„ í†µê³¼í•˜ëŠ” ì „ì²´ ì—¬ì • |
| **Span** | í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„ (ì„œë¹„ìŠ¤ í˜¸ì¶œ, DB ì¿¼ë¦¬ ë“±) |
| **í—¤ë” ì „íŒŒ** | ë“¤ì–´ì˜¨ íŠ¸ë ˆì´ì‹± í—¤ë”ë¥¼ ë‚˜ê°€ëŠ” ìš”ì²­ì— ë³µì‚¬ (í•„ìˆ˜!) |
| **ìƒ˜í”Œë§** | í”„ë¡œë•ì…˜ì—ì„œëŠ” 1-10% ê¶Œì¥ |

### Istioê°€ í•˜ëŠ” ê²ƒ vs ë‚´ê°€ í•´ì•¼ í•˜ëŠ” ê²ƒ

| Istio ìë™ | ê°œë°œì í•„ìˆ˜ |
|------------|-------------|
| Span ìƒì„± | í—¤ë” ì „íŒŒ êµ¬í˜„ |
| Trace ID ìƒì„± | ëª¨ë“  ì™¸ë¶€ í˜¸ì¶œì— ì ìš© |
| Jaegerë¡œ ì „ì†¡ | ë¹„ë™ê¸° í˜¸ì¶œ ì²˜ë¦¬ |

---

## ğŸ”— ë‹¤ìŒ í¸ ì˜ˆê³ 

Part 3ì—ì„œëŠ” **Envoy Access Log**ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤:
- Access Log í¬ë§·
- Response Flags ë¶„ì„
- ë¬¸ì œ ì§„ë‹¨ ê°€ì´ë“œ

---

## ğŸ”— ì°¸ê³  ìë£Œ

- [Istio Distributed Tracing](https://istio.io/latest/docs/tasks/observability/distributed-tracing/)
- [Jaeger Documentation](https://www.jaegertracing.io/docs/)
- [OpenTelemetry Tracing](https://opentelemetry.io/docs/concepts/signals/traces/)
- [B3 Propagation](https://github.com/openzipkin/b3-propagation)
