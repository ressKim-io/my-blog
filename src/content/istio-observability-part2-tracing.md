---
title: "Istio Observability Part 2: ë¶„ì‚° íŠ¸ë ˆì´ì‹±ìœ¼ë¡œ ìš”ì²­ íë¦„ ì¶”ì í•˜ê¸°"
excerpt: "Jaegerë¥¼ í™œìš©í•œ ë¶„ì‚° íŠ¸ë ˆì´ì‹±ê³¼ í—¤ë” ì „íŒŒì˜ ì¤‘ìš”ì„±"
category: "kubernetes"
tags: ["istio", "observability", "tracing", "jaeger", "distributed-tracing", "kubernetes"]
series:
  name: "istio-observability"
  order: 2
date: "2024-12-24"
---

## ğŸ¯ ì‹œì‘í•˜ë©°

Part 1ì—ì„œ ë©”íŠ¸ë¦­ìœ¼ë¡œ "ë¬´ì—‡ì´ ì¼ì–´ë‚˜ëŠ”ê°€"ë¥¼ ë´¤ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì—ì„œëŠ” **"ìš”ì²­ì´ ì–´ë””ë¥¼ ê±°ì³ê°”ëŠ”ê°€"**ë¥¼ ì•„ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ë¶„ì‚° íŠ¸ë ˆì´ì‹±ì´ í•„ìš”í•œ ìƒí™©                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   ì‚¬ìš©ì: "ê²°ì œê°€ ëŠë ¤ìš”!"                                      â”‚
â”‚                                                                 â”‚
â”‚   ë©”íŠ¸ë¦­ìœ¼ë¡œ í™•ì¸:                                              â”‚
â”‚   - payment-service P99: 3ì´ˆ (ëŠë¦¼!)                            â”‚
â”‚   - ê·¼ë°... ì™œ ëŠë¦° ê±°ì§€?                                       â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚Frontendâ”‚â”€â”€â–¶â”‚  API   â”‚â”€â”€â–¶â”‚Payment â”‚â”€â”€â–¶â”‚  Bank  â”‚             â”‚
â”‚   â”‚   ?    â”‚   â”‚   ?    â”‚   â”‚   ?    â”‚   â”‚  API   â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â”‚   ëˆ„ê°€ ë²”ì¸ì¸ì§€ ëª¨ë¦„!                                           â”‚
â”‚                                                                 â”‚
â”‚   ë¶„ì‚° íŠ¸ë ˆì´ì‹±ìœ¼ë¡œ í™•ì¸:                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ Trace ID: abc123                                       â”‚    â”‚
â”‚   â”‚                                                        â”‚    â”‚
â”‚   â”‚ Frontend â–ˆâ–ˆâ–ˆâ–ˆ (50ms)                                   â”‚    â”‚
â”‚   â”‚   â””â”€ API   â–ˆâ–ˆâ–ˆâ–ˆ (100ms)                                â”‚    â”‚
â”‚   â”‚       â””â”€ Payment â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (2.5s)     â”‚    â”‚
â”‚   â”‚           â””â”€ Bank API â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (2.3s) ğŸ”´   â”‚    â”‚
â”‚   â”‚                                                        â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚   ë²”ì¸: Bank API! (ì™¸ë¶€ APIê°€ ëŠë¦¼)                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

í•™ìŠµí•˜ë©´ì„œ ê¶ê¸ˆí–ˆë˜ ê²ƒë“¤ì…ë‹ˆë‹¤:
- Traceì™€ Spanì€ ë¬´ì—‡ì¼ê¹Œ?
- Istioê°€ ìë™ìœ¼ë¡œ í•´ì£¼ëŠ” ê²ƒê³¼ ë‚´ê°€ í•´ì•¼ í•˜ëŠ” ê²ƒì€?
- í—¤ë” ì „íŒŒëŠ” ì™œ ì¤‘ìš”í• ê¹Œ?

---

## ğŸ’¡ ë¶„ì‚° íŠ¸ë ˆì´ì‹± ê°œë…

### Traceì™€ Span

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Traceì™€ Span êµ¬ì¡°                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Trace: í•˜ë‚˜ì˜ ìš”ì²­ì´ ì‹œìŠ¤í…œì„ í†µê³¼í•˜ëŠ” ì „ì²´ ì—¬ì •              â”‚
â”‚          ê³ ìœ í•œ Trace IDë¡œ ì‹ë³„                                 â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Trace ID: 7f2a8b9c...                                  â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚  Span A (Root Span)                                     â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ service: frontend                                  â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ operation: GET /checkout                           â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ duration: 350ms                                    â”‚   â”‚
â”‚   â”‚  â”‚                                                      â”‚   â”‚
â”‚   â”‚  â””â”€â”€ Span B (Child Span)                                â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ service: api-gateway                           â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ operation: POST /api/order                     â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ duration: 300ms                                â”‚   â”‚
â”‚   â”‚      â”‚                                                  â”‚   â”‚
â”‚   â”‚      â””â”€â”€ Span C (Child Span)                            â”‚   â”‚
â”‚   â”‚          â”œâ”€â”€ service: payment                           â”‚   â”‚
â”‚   â”‚          â”œâ”€â”€ operation: processPayment                  â”‚   â”‚
â”‚   â”‚          â”œâ”€â”€ duration: 250ms                            â”‚   â”‚
â”‚   â”‚          â”‚                                              â”‚   â”‚
â”‚   â”‚          â””â”€â”€ Span D (Child Span)                        â”‚   â”‚
â”‚   â”‚              â”œâ”€â”€ service: bank-api                      â”‚   â”‚
â”‚   â”‚              â”œâ”€â”€ operation: POST /charge                â”‚   â”‚
â”‚   â”‚              â””â”€â”€ duration: 200ms                        â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚   Span: í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„                                        â”‚
â”‚         - ê³ ìœ í•œ Span ID                                        â”‚
â”‚         - Parent Span ID (ë¶€ëª¨ ì°¸ì¡°)                            â”‚
â”‚         - ì‹œì‘ ì‹œê°„, ì¢…ë£Œ ì‹œê°„                                  â”‚
â”‚         - íƒœê·¸, ë¡œê·¸                                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### íƒ€ì„ë¼ì¸ ë·°

```
ì‹œê°„ â†’
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
|                                                |
|  Span A (Frontend)                             |
|  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  |
|  0ms                                    350ms  |
|      |                                         |
|      Span B (API Gateway)                      |
|      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ        |
|      50ms                            350ms     |
|          |                                     |
|          Span C (Payment)                      |
|          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ            |
|          100ms                     350ms       |
|              |                                 |
|              Span D (Bank API)                 |
|              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              |
|              150ms               350ms         |
|                                                |
|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|
```

---

## ğŸ”§ Istio íŠ¸ë ˆì´ì‹± ì„¤ì •

### Jaeger ì„¤ì¹˜

```bash
# Istio ì• ë“œì˜¨ìœ¼ë¡œ ì„¤ì¹˜
$ kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/addons/jaeger.yaml

# í™•ì¸
$ kubectl get pods -n istio-system -l app=jaeger

# ì ‘ì†
$ kubectl port-forward -n istio-system svc/tracing 16686:80

# ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:16686 ì ‘ì†
```

### ìƒ˜í”Œë§ ì„¤ì •

```yaml
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  meshConfig:
    defaultConfig:
      tracing:
        sampling: 100.0    # 100% ìƒ˜í”Œë§ (ê°œë°œí™˜ê²½)
        # sampling: 1.0    # 1% ìƒ˜í”Œë§ (í”„ë¡œë•ì…˜)
```

í”„ë¡œë•ì…˜ì—ì„œ 100%ëŠ” ì˜¤ë²„í—¤ë“œê°€ í¬ë¯€ë¡œ 1~10% ì •ë„ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

### Telemetry APIë¡œ ì„¤ì •

```yaml
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: tracing-config
  namespace: istio-system
spec:
  tracing:
  - providers:
    - name: jaeger
    randomSamplingPercentage: 10.0   # 10% ìƒ˜í”Œë§
```

---

## âš ï¸ í•µì‹¬: í—¤ë” ì „íŒŒ (Header Propagation)

**Istioê°€ ìë™ìœ¼ë¡œ í•˜ëŠ” ê²ƒ**:
- Span ìƒì„±
- Trace ID ìƒì„± (ì—†ìœ¼ë©´)
- ë©”íŠ¸ë¦­/ë¡œê·¸ ìˆ˜ì§‘

**ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•´ì•¼ í•˜ëŠ” ê²ƒ**:
- ë“¤ì–´ì˜¨ íŠ¸ë ˆì´ì‹± í—¤ë”ë¥¼ ë‚˜ê°€ëŠ” ìš”ì²­ì— ì „íŒŒ!

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    í—¤ë” ì „íŒŒì˜ ì¤‘ìš”ì„±                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   âŒ í—¤ë” ì „íŒŒ ì•ˆ í•¨ (Traceê°€ ëŠê¹€)                             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                              â”‚
â”‚                                                                 â”‚
â”‚   ìš”ì²­ ë“¤ì–´ì˜´                     ë‚˜ê°€ëŠ” ìš”ì²­                   â”‚
â”‚   x-request-id: abc               x-request-id: ??? (ì—†ìŒ!)     â”‚
â”‚   x-b3-traceid: xyz               x-b3-traceid: ??? (ì—†ìŒ!)     â”‚
â”‚                                                                 â”‚
â”‚   Jaegerì—ì„œ ë³´ì´ëŠ” ê²ƒ:                                         â”‚
â”‚   [Trace 1] Frontend â–ˆâ–ˆâ–ˆâ–ˆ                                       â”‚
â”‚   [Trace 2]           API â–ˆâ–ˆâ–ˆâ–ˆ      â† ë‹¤ë¥¸ Traceë¡œ ë¶„ë¦¬ë¨!      â”‚
â”‚   [Trace 3]                Payment â–ˆâ–ˆâ–ˆâ–ˆ                         â”‚
â”‚                                                                 â”‚
â”‚   âœ… í—¤ë” ì „íŒŒí•¨ (Traceê°€ ì—°ê²°ë¨)                               â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                              â”‚
â”‚                                                                 â”‚
â”‚   ìš”ì²­ ë“¤ì–´ì˜´                     ë‚˜ê°€ëŠ” ìš”ì²­                   â”‚
â”‚   x-request-id: abc       â†’       x-request-id: abc             â”‚
â”‚   x-b3-traceid: xyz       â†’       x-b3-traceid: xyz             â”‚
â”‚                                                                 â”‚
â”‚   Jaegerì—ì„œ ë³´ì´ëŠ” ê²ƒ:                                         â”‚
â”‚   [Trace 1] Frontend â–ˆâ–ˆâ–ˆâ–ˆ                                       â”‚
â”‚               â””â”€â”€ API â–ˆâ–ˆâ–ˆâ–ˆ                                      â”‚
â”‚                   â””â”€â”€ Payment â–ˆâ–ˆâ–ˆâ–ˆ   â† í•˜ë‚˜ì˜ Traceë¡œ ì—°ê²°!     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì „íŒŒí•´ì•¼ í•  í—¤ë” ëª©ë¡

```
# B3 í˜•ì‹ (Zipkin)
x-b3-traceid
x-b3-spanid
x-b3-parentspanid
x-b3-sampled
x-b3-flags

# W3C Trace Context
traceparent
tracestate

# Istio/Envoy ì¶”ê°€ í—¤ë”
x-request-id
x-ot-span-context

# ê¶Œì¥: ëª¨ë‘ ì „íŒŒ
```

### ì–¸ì–´ë³„ í—¤ë” ì „íŒŒ êµ¬í˜„

#### Go

```go
func handler(w http.ResponseWriter, r *http.Request) {
    // ì „íŒŒí•  í—¤ë”ë“¤
    headers := []string{
        "x-request-id",
        "x-b3-traceid",
        "x-b3-spanid",
        "x-b3-parentspanid",
        "x-b3-sampled",
        "x-b3-flags",
        "traceparent",
        "tracestate",
    }

    // ì™¸ë¶€ ì„œë¹„ìŠ¤ í˜¸ì¶œ ì‹œ í—¤ë” ì „íŒŒ
    client := &http.Client{}
    req, _ := http.NewRequest("GET", "http://backend/api", nil)

    for _, h := range headers {
        if value := r.Header.Get(h); value != "" {
            req.Header.Set(h, value)
        }
    }

    resp, err := client.Do(req)
    // ...
}
```

#### Python (Flask)

```python
from flask import Flask, request
import requests

app = Flask(__name__)

TRACE_HEADERS = [
    'x-request-id',
    'x-b3-traceid',
    'x-b3-spanid',
    'x-b3-parentspanid',
    'x-b3-sampled',
    'x-b3-flags',
    'traceparent',
    'tracestate',
]

@app.route('/api/process')
def process():
    # í—¤ë” ì „íŒŒ
    headers = {h: request.headers.get(h)
               for h in TRACE_HEADERS
               if request.headers.get(h)}

    # ì™¸ë¶€ ì„œë¹„ìŠ¤ í˜¸ì¶œ
    response = requests.get('http://backend/api', headers=headers)
    return response.json()
```

#### Java (Spring)

```java
@RestController
public class ApiController {

    private static final List<String> TRACE_HEADERS = Arrays.asList(
        "x-request-id",
        "x-b3-traceid",
        "x-b3-spanid",
        "x-b3-parentspanid",
        "x-b3-sampled",
        "x-b3-flags",
        "traceparent",
        "tracestate"
    );

    @Autowired
    private RestTemplate restTemplate;

    @GetMapping("/api/process")
    public ResponseEntity<String> process(HttpServletRequest request) {
        HttpHeaders headers = new HttpHeaders();

        // í—¤ë” ì „íŒŒ
        TRACE_HEADERS.forEach(h -> {
            String value = request.getHeader(h);
            if (value != null) {
                headers.add(h, value);
            }
        });

        HttpEntity<String> entity = new HttpEntity<>(headers);
        return restTemplate.exchange(
            "http://backend/api",
            HttpMethod.GET,
            entity,
            String.class
        );
    }
}
```

#### Node.js (Express)

```javascript
const express = require('express');
const axios = require('axios');

const app = express();

const TRACE_HEADERS = [
    'x-request-id',
    'x-b3-traceid',
    'x-b3-spanid',
    'x-b3-parentspanid',
    'x-b3-sampled',
    'x-b3-flags',
    'traceparent',
    'tracestate',
];

app.get('/api/process', async (req, res) => {
    // í—¤ë” ì „íŒŒ
    const headers = {};
    TRACE_HEADERS.forEach(h => {
        if (req.headers[h.toLowerCase()]) {
            headers[h] = req.headers[h.toLowerCase()];
        }
    });

    // ì™¸ë¶€ ì„œë¹„ìŠ¤ í˜¸ì¶œ
    const response = await axios.get('http://backend/api', { headers });
    res.json(response.data);
});
```

---

## ğŸ“Š Jaeger UI í™œìš©

### ê¸°ë³¸ í™”ë©´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Jaeger UI                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Service: [frontend â–¼]    Operation: [all â–¼]                   â”‚
â”‚   Lookback: [Last Hour â–¼]  Limit: [20]                          â”‚
â”‚                                                                 â”‚
â”‚   [Find Traces]                                                 â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Traces                                                 â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚  â— abc123  frontend â†’ api â†’ payment    350ms   3 spans  â”‚   â”‚
â”‚   â”‚  â— def456  frontend â†’ api              150ms   2 spans  â”‚   â”‚
â”‚   â”‚  â— ghi789  frontend â†’ api â†’ payment    1.2s    3 spans  â”‚   â”‚
â”‚   â”‚            â†’ bank-api                          4 spans  â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Trace ìƒì„¸ í™”ë©´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Trace abc123                                     Total: 350ms â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   frontend [GET /checkout]                                      â”‚
â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  350ms   â”‚
â”‚   â”‚                                                             â”‚
â”‚   â””â”€â”€ api-gateway [POST /api/order]                             â”‚
â”‚       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      300ms   â”‚
â”‚       â”‚                                                         â”‚
â”‚       â”œâ”€â”€ payment [processPayment]                              â”‚
â”‚       â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ            250ms   â”‚
â”‚       â”‚   â”‚                                                     â”‚
â”‚       â”‚   â””â”€â”€ bank-api [POST /charge]                           â”‚
â”‚       â”‚       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              200ms   â”‚
â”‚       â”‚                                                         â”‚
â”‚       â””â”€â”€ inventory [checkStock]                                â”‚
â”‚           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                         50ms   â”‚
â”‚                                                                 â”‚
â”‚   Tags:                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ http.method: POST                                     â”‚     â”‚
â”‚   â”‚ http.url: /api/order                                  â”‚     â”‚
â”‚   â”‚ http.status_code: 200                                 â”‚     â”‚
â”‚   â”‚ node_id: sidecar~10.1.2.3~api-gateway-xxx             â”‚     â”‚
â”‚   â”‚ upstream_cluster: outbound|80||payment.default...     â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ ì‹¤ì „ ë””ë²„ê¹…

### ëŠë¦° ìš”ì²­ ì°¾ê¸°

```
1. Jaegerì—ì„œ Service ì„ íƒ
2. Lookback: Last Hour
3. Min Duration: 1s (ëŠë¦° ìš”ì²­ë§Œ)
4. Find Traces

ê²°ê³¼ì—ì„œ ë³‘ëª© ì§€ì  í™•ì¸:
- ì–´ë–¤ Spanì´ ê°€ì¥ ì˜¤ë˜ ê±¸ë¦¬ëŠ”ê°€?
- íŠ¹ì • ì„œë¹„ìŠ¤ì—ì„œ ì¼ê´€ë˜ê²Œ ëŠë¦°ê°€?
```

### ì—ëŸ¬ ì¶”ì 

```
1. Tags ê²€ìƒ‰: error=true
2. ë˜ëŠ” Tags: http.status_code=500

ì—ëŸ¬ Spanì—ì„œ í™•ì¸:
- ì–´ë””ì„œ ì—ëŸ¬ê°€ ì‹œì‘ëëŠ”ê°€?
- ì—ëŸ¬ ë©”ì‹œì§€ëŠ”?
- ì—ëŸ¬ ë°œìƒ ì§ì „ ìƒí™©ì€?
```

### ë¹„êµ ë¶„ì„

```
1. ëŠë¦° Traceì™€ ë¹ ë¥¸ Trace ë¹„êµ
2. ì°¨ì´ì :
   - ì¶”ê°€ í˜¸ì¶œì´ ìˆëŠ”ê°€?
   - íŠ¹ì • ì„œë¹„ìŠ¤ê°€ ë” ëŠë¦°ê°€?
   - ì¬ì‹œë„ê°€ ë°œìƒí–ˆëŠ”ê°€?
```

---

## âš™ï¸ ê³ ê¸‰ ì„¤ì •

### ì»¤ìŠ¤í…€ íƒœê·¸ ì¶”ê°€

```yaml
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: custom-tags
  namespace: default
spec:
  tracing:
  - customTags:
      my_custom_tag:
        header:
          name: x-custom-header
          defaultValue: "unknown"
      user_id:
        header:
          name: x-user-id
```

### íŠ¹ì • ê²½ë¡œ ìƒ˜í”Œë§ ì¡°ì ˆ

```yaml
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: selective-tracing
  namespace: default
spec:
  selector:
    matchLabels:
      app: payment-service
  tracing:
  - randomSamplingPercentage: 100.0   # ê²°ì œëŠ” 100%
---
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: health-no-trace
  namespace: default
spec:
  tracing:
  - disableSpanReporting: true
    match:
      mode: SERVER
  # /health, /metricsëŠ” íŠ¸ë ˆì´ì‹± ì œì™¸
```

---

## ğŸ“ˆ íŠ¸ë ˆì´ì‹± ë©”íŠ¸ë¦­

Jaeger ìì²´ë„ ë©”íŠ¸ë¦­ì„ ì œê³µí•©ë‹ˆë‹¤:

```promql
# Span ì²˜ë¦¬ëŸ‰
sum(rate(jaeger_spans_received_total[5m])) by (svc)

# ìƒ˜í”Œë§ëœ Span ìˆ˜
sum(rate(jaeger_spans_sampled_total[5m]))

# íŠ¸ë ˆì´ìŠ¤ ì €ì¥ ì§€ì—°
histogram_quantile(0.99,
  sum(rate(jaeger_span_storage_latency_bucket[5m])) by (le)
)
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ìƒ˜í”Œë§ ë¹„ìœ¨

```yaml
# ê°œë°œí™˜ê²½: 100% OK
sampling: 100.0

# í”„ë¡œë•ì…˜: 1-10% ê¶Œì¥
sampling: 1.0    # 1%
# ë˜ëŠ”
sampling: 10.0   # 10%

# ì´ìœ :
# - ë„¤íŠ¸ì›Œí¬ ì˜¤ë²„í—¤ë“œ
# - ì €ì¥ ê³µê°„
# - ì²˜ë¦¬ ë¹„ìš©
```

### 2. í—¤ë” ì „íŒŒ ëˆ„ë½

ê°€ì¥ í”í•œ ì‹¤ìˆ˜ì…ë‹ˆë‹¤. Traceê°€ ëŠê¸°ë©´:
1. ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì˜ í—¤ë” í™•ì¸
2. ë‚˜ê°€ëŠ” ìš”ì²­ì— í—¤ë” ë³µì‚¬ í™•ì¸
3. ëª¨ë“  ì™¸ë¶€ í˜¸ì¶œì— ì ìš©ëëŠ”ì§€ í™•ì¸

### 3. ë¹„ë™ê¸° ì²˜ë¦¬

```go
// âŒ ë¹„ë™ê¸°ì—ì„œ í—¤ë” ì „íŒŒ ëˆ„ë½
go func() {
    // ì»¨í…ìŠ¤íŠ¸/í—¤ë” ì—†ì´ í˜¸ì¶œ
    client.Call("http://service/api")
}()

// âœ… ì»¨í…ìŠ¤íŠ¸ ì „ë‹¬
go func(headers map[string]string) {
    req, _ := http.NewRequest("GET", "http://service/api", nil)
    for k, v := range headers {
        req.Header.Set(k, v)
    }
    client.Do(req)
}(extractHeaders(originalRequest))
```

---

## ğŸ“š ì •ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ë¶„ì‚° íŠ¸ë ˆì´ì‹± ì²´í¬ë¦¬ìŠ¤íŠ¸                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   âœ… ì¸í”„ë¼ ì„¤ì •                                                â”‚
â”‚      â–¡ Jaeger ì„¤ì¹˜                                              â”‚
â”‚      â–¡ ìƒ˜í”Œë§ ë¹„ìœ¨ ì„¤ì • (í”„ë¡œë•ì…˜ 1-10%)                        â”‚
â”‚      â–¡ ì €ì¥ ê¸°ê°„ ì„¤ì •                                           â”‚
â”‚                                                                 â”‚
â”‚   âœ… ì• í”Œë¦¬ì¼€ì´ì…˜ (í•„ìˆ˜!)                                       â”‚
â”‚      â–¡ íŠ¸ë ˆì´ì‹± í—¤ë” ì „íŒŒ êµ¬í˜„                                  â”‚
â”‚      â–¡ ëª¨ë“  ì™¸ë¶€ í˜¸ì¶œì— ì ìš©                                    â”‚
â”‚      â–¡ ë¹„ë™ê¸° í˜¸ì¶œë„ í™•ì¸                                       â”‚
â”‚                                                                 â”‚
â”‚   âœ… ìš´ì˜                                                       â”‚
â”‚      â–¡ ëŠë¦° ìš”ì²­ ëª¨ë‹ˆí„°ë§                                       â”‚
â”‚      â–¡ ì—ëŸ¬ íŠ¸ë ˆì´ìŠ¤ ë¶„ì„                                       â”‚
â”‚      â–¡ ì„œë¹„ìŠ¤ ì˜ì¡´ì„± íŒŒì•…                                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ í•µì‹¬ ì •ë¦¬

| ê°œë… | ì„¤ëª… |
|------|------|
| **Trace** | í•˜ë‚˜ì˜ ìš”ì²­ì´ ì‹œìŠ¤í…œì„ í†µê³¼í•˜ëŠ” ì „ì²´ ì—¬ì • |
| **Span** | í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„ (ì„œë¹„ìŠ¤ í˜¸ì¶œ, DB ì¿¼ë¦¬ ë“±) |
| **í—¤ë” ì „íŒŒ** | ë“¤ì–´ì˜¨ íŠ¸ë ˆì´ì‹± í—¤ë”ë¥¼ ë‚˜ê°€ëŠ” ìš”ì²­ì— ë³µì‚¬ (í•„ìˆ˜!) |
| **ìƒ˜í”Œë§** | í”„ë¡œë•ì…˜ì—ì„œëŠ” 1-10% ê¶Œì¥ |

### Istioê°€ í•˜ëŠ” ê²ƒ vs ë‚´ê°€ í•´ì•¼ í•˜ëŠ” ê²ƒ

| Istio ìë™ | ê°œë°œì í•„ìˆ˜ |
|------------|-------------|
| Span ìƒì„± | í—¤ë” ì „íŒŒ êµ¬í˜„ |
| Trace ID ìƒì„± | ëª¨ë“  ì™¸ë¶€ í˜¸ì¶œì— ì ìš© |
| Jaegerë¡œ ì „ì†¡ | ë¹„ë™ê¸° í˜¸ì¶œ ì²˜ë¦¬ |

---

## ğŸ”— ë‹¤ìŒ í¸ ì˜ˆê³ 

Part 3ì—ì„œëŠ” **Envoy Access Log**ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤:
- Access Log í¬ë§·
- Response Flags ë¶„ì„
- ë¬¸ì œ ì§„ë‹¨ ê°€ì´ë“œ

---

## ğŸ”— ì°¸ê³  ìë£Œ

- [Istio Distributed Tracing](https://istio.io/latest/docs/tasks/observability/distributed-tracing/)
- [Jaeger Documentation](https://www.jaegertracing.io/docs/)
- [OpenTelemetry Tracing](https://opentelemetry.io/docs/concepts/signals/traces/)
- [B3 Propagation](https://github.com/openzipkin/b3-propagation)
