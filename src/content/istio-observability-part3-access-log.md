---
title: "Istio Observability Part 3: Envoy Access Logλ΅ λ¬Έμ  μ§„λ‹¨ν•κΈ°"
excerpt: "Envoy Access Logμ Response Flagsλ¥Ό μ΄ν•΄ν•κ³  λ¬Έμ λ¥Ό μ§„λ‹¨ν•λ” λ°©λ²•"
category: "kubernetes"
tags: ["istio", "observability", "access-log", "envoy", "debugging", "kubernetes"]
series:
  name: "istio-observability"
  order: 3
date: "2024-12-24"
---

## π― μ‹μ‘ν•λ©°

Part 1μ—μ„ λ©”νΈλ¦­, Part 2μ—μ„ νΈλ μ΄μ‹±μ„ λ°°μ› μµλ‹λ‹¤. μ΄λ²μ—λ” κ°€μ¥ μƒμ„Έν• μ •λ³΄λ¥Ό μ κ³µν•λ” **Access Log**λ¥Ό λ‹¤λ£Ήλ‹λ‹¤.

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                   Observability 3κ°€μ§€ μ¶•                        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚   Metrics                  Tracing                 Logging      β”‚
β”‚   β•β•β•β•β•β•β•                  β•β•β•β•β•β•β•                 β•β•β•β•β•β•β•      β”‚
β”‚                                                                 β”‚
β”‚   "μ–Όλ§λ‚?"                "μ–΄λ””λ¥Ό?"              "λ¬΄μ¨ μΌμ΄?"  β”‚
β”‚                                                                 β”‚
β”‚   - μ§‘κ³„λ μμΉ           - μ”μ²­ κ²½λ΅             - κ°λ³„ μ΄λ²¤νΈ β”‚
β”‚   - μ¶”μ„Έ νμ•…             - λ³‘λ© μ§€μ              - μƒμ„Έ μ›μΈ   β”‚
β”‚   - λ€μ‹λ³΄λ“              - μμ΅΄μ„± νμ•…           - λ””λ²„κΉ…      β”‚
β”‚                                                                 β”‚
β”‚   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”             β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”             β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚   β”‚  π“     β”‚             β”‚  π”     β”‚             β”‚  π“     β”‚   β”‚
β”‚   β”‚ 1000    β”‚             β”‚ Aβ†’Bβ†’C   β”‚             β”‚ [ERROR] β”‚   β”‚
β”‚   β”‚ req/s   β”‚             β”‚   β””β†’D   β”‚             β”‚ ...     β”‚   β”‚
β”‚   β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”             β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”             β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                                                    β†‘             β”‚
β”‚                                                    μ΄λ² Part     β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

ν•™μµν•λ©΄μ„ κ¶κΈν–λ κ²ƒλ“¤μ…λ‹λ‹¤:
- Access Logλ” μ–΄λ–¤ μ •λ³΄λ¥Ό λ‹΄κ³  μμ„κΉ?
- Response Flagsλ” λ¬΄μ—‡μ„ μλ―Έν• κΉ?
- μ‹¤μ  λ¬Έμ  μ§„λ‹¨μ— μ–΄λ–»κ² ν™μ©ν• κΉ?

---

## π’΅ Envoy Access Log μ΄ν•΄

### Access Log ν™μ„±ν™”

κΈ°λ³Έμ μΌλ΅ Istioλ” Access Logλ¥Ό λΉ„ν™μ„±ν™”ν•©λ‹λ‹¤. ν™μ„±ν™”κ°€ ν•„μ”ν•©λ‹λ‹¤:

```yaml
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  meshConfig:
    accessLogFile: /dev/stdout           # stdoutμΌλ΅ μ¶λ ¥
    accessLogEncoding: JSON              # JSON ν•μ‹ (λλ” TEXT)
```

λλ” Telemetry APIλ΅:

```yaml
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: access-log
  namespace: istio-system
spec:
  accessLogging:
  - providers:
    - name: envoy
```

### κΈ°λ³Έ λ΅κ·Έ ν•μ‹ (TEXT)

```
[2024-12-24T10:15:30.123Z] "GET /api/products HTTP/1.1" 200 - via_upstream - "-" 0 1234 45 43 "-" "Mozilla/5.0" "abc-123" "productpage:9080" "10.1.2.3:9080" inbound|9080|| 10.1.2.3:54321 10.1.2.3:9080 10.1.2.4:12345 - default
```

### JSON ν•μ‹

```json
{
  "start_time": "2024-12-24T10:15:30.123Z",
  "method": "GET",
  "path": "/api/products",
  "protocol": "HTTP/1.1",
  "response_code": 200,
  "response_flags": "-",
  "bytes_received": 0,
  "bytes_sent": 1234,
  "duration": 45,
  "upstream_service_time": 43,
  "x_forwarded_for": "-",
  "user_agent": "Mozilla/5.0",
  "request_id": "abc-123",
  "authority": "productpage:9080",
  "upstream_host": "10.1.2.3:9080",
  "upstream_cluster": "inbound|9080||",
  "downstream_remote_address": "10.1.2.4:12345",
  "route_name": "default"
}
```

---

## π© Response Flags μ™„μ „ μ •λ³µ

Response Flagsλ” μ”μ²­ μ²λ¦¬ μ¤‘ λ°μƒν• λ¬Έμ λ¥Ό λ‚νƒ€λƒ…λ‹λ‹¤. κ°€μ¥ μ¤‘μ”ν• λ””λ²„κΉ… μ •λ³΄μ…λ‹λ‹¤.

### μ£Όμ” Response Flags

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                   Response Flags λ¶„λ¥                           β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚   μ •μƒ                                                          β”‚
β”‚   β•β•β•β•                                                          β”‚
β”‚   -         : μ—λ¬ μ—†μ                                         β”‚
β”‚                                                                 β”‚
β”‚   Upstream (μ„λ²„μΈ΅) λ¬Έμ                                         β”‚
β”‚   β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•                                        β”‚
β”‚   UO        : Upstream Overflow (Circuit Breaker λ°λ™)          β”‚
β”‚   UF        : Upstream Connection Failure                       β”‚
β”‚   UT        : Upstream Request Timeout                          β”‚
β”‚   UC        : Upstream Connection Termination                   β”‚
β”‚   URX       : Upstream Retry Limit Exceeded                     β”‚
β”‚   UH        : No Healthy Upstream                               β”‚
β”‚   NR        : No Route Configured                               β”‚
β”‚                                                                 β”‚
β”‚   Downstream (ν΄λΌμ΄μ–ΈνΈμΈ΅) λ¬Έμ                                 β”‚
β”‚   β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•                                β”‚
β”‚   DC        : Downstream Connection Termination                 β”‚
β”‚   DT        : Downstream Request Timeout                        β”‚
β”‚                                                                 β”‚
β”‚   λ΅μ»¬ (Envoy) λ¬Έμ                                              β”‚
β”‚   β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•                                            β”‚
β”‚   LR        : Local Reset                                       β”‚
β”‚   LH        : Local Health Check Failed                         β”‚
β”‚   RL        : Rate Limited                                      β”‚
β”‚   UAEX      : Unauthorized External                             β”‚
β”‚   RLSE      : Rate Limited by Service Error                     β”‚
β”‚                                                                 β”‚
β”‚   κΈ°νƒ€                                                          β”‚
β”‚   β•β•β•β•β•β•                                                        β”‚
β”‚   IH        : Invalid Headers                                   β”‚
β”‚   NFCF      : No Filter Chain Found                             β”‚
β”‚   DPE       : Downstream Protocol Error                         β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### μμ£Ό λ³΄λ” Response Flags μƒμ„Έ

#### UO (Upstream Overflow)

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   UO - Upstream Overflow                                        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚   μ›μΈ: DestinationRuleμ Connection Pool μ΄κ³Ό                  β”‚
β”‚                                                                 β”‚
β”‚   μ”μ²­ β”€β”€β–¶ [Connection Pool κ°€λ“!] β”€β”€Xβ”€β”€β–¶ μ„λΉ„μ¤                β”‚
β”‚               β”‚                                                 β”‚
β”‚               β””β”€β”€β–¶ 503 + UO λ°ν™                                β”‚
β”‚                                                                 β”‚
β”‚   ν™•μΈν•  κ²ƒ:                                                    β”‚
β”‚   1. DestinationRuleμ connectionPool μ„¤μ •                      β”‚
β”‚   2. μ„λΉ„μ¤μ μ‹¤μ  μ²λ¦¬ λ¥λ ¥                                    β”‚
β”‚   3. λ™μ‹ μ”μ²­ μ                                               β”‚
β”‚                                                                 β”‚
β”‚   ν•΄κ²°:                                                         β”‚
β”‚   - connectionPool.http.http2MaxRequests μ¦κ°€                   β”‚
β”‚   - connectionPool.tcp.maxConnections μ¦κ°€                      β”‚
β”‚   - μ„λΉ„μ¤ μ¤μΌ€μΌ μ•„μ›ƒ                                          β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### UF (Upstream Connection Failure)

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   UF - Upstream Connection Failure                              β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚   μ›μΈ: μ„λΉ„μ¤μ— μ—°κ²°ν•  μ μ—†μ                                 β”‚
β”‚                                                                 β”‚
β”‚   μ”μ²­ β”€β”€β–¶ μ—°κ²° μ‹λ„ β”€β”€Xβ”€β”€β–¶ μ„λΉ„μ¤ (μ‘λ‹µ μ—†μ)                  β”‚
β”‚               β”‚                                                 β”‚
β”‚               β””β”€β”€β–¶ 503 + UF λ°ν™                                β”‚
β”‚                                                                 β”‚
β”‚   ν™•μΈν•  κ²ƒ:                                                    β”‚
β”‚   1. μ„λΉ„μ¤κ°€ μ‹¤ν–‰ μ¤‘μΈκ°€?                                      β”‚
β”‚   2. Podκ°€ Ready μƒνƒμΈκ°€?                                      β”‚
β”‚   3. Service ν¬νΈκ°€ μ¬λ°”λ¥Έκ°€?                                   β”‚
β”‚   4. NetworkPolicyκ°€ λ§‰κ³  μλ”κ°€?                               β”‚
β”‚                                                                 β”‚
β”‚   ν•΄κ²°:                                                         β”‚
β”‚   - kubectl get pods -l app=<service>                           β”‚
β”‚   - kubectl describe svc <service>                              β”‚
β”‚   - kubectl get networkpolicy                                   β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### NR (No Route)

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   NR - No Route Configured                                      β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚   μ›μΈ: μ”μ²­μ„ μ–΄λ””λ΅ λ³΄λ‚Όμ§€ λ¨λ¦„                               β”‚
β”‚                                                                 β”‚
β”‚   μ”μ²­ β”€β”€β–¶ VirtualService? β”€β”€Xβ”€β”€β–¶ ???                           β”‚
β”‚               β”‚                                                 β”‚
β”‚               β””β”€β”€β–¶ 404 + NR λ°ν™                                β”‚
β”‚                                                                 β”‚
β”‚   ν™•μΈν•  κ²ƒ:                                                    β”‚
β”‚   1. VirtualServiceκ°€ μλ”κ°€?                                   β”‚
β”‚   2. hostsκ°€ μ¬λ°”λ¥Έκ°€?                                          β”‚
β”‚   3. Serviceκ°€ μ΅΄μ¬ν•λ”κ°€?                                      β”‚
β”‚                                                                 β”‚
β”‚   ν•΄κ²°:                                                         β”‚
β”‚   - istioctl analyze                                            β”‚
β”‚   - kubectl get vs -A                                           β”‚
β”‚   - kubectl get svc                                             β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### URX (Upstream Retry Limit Exceeded)

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   URX - Upstream Retry Limit Exceeded                           β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚   μ›μΈ: μ¬μ‹λ„ νμ μ΄κ³Ό                                        β”‚
β”‚                                                                 β”‚
β”‚   μ”μ²­ β”€β”€β–¶ 1μ°¨ μ‹λ„ β”€β”€X                                         β”‚
β”‚        β”€β”€β–¶ 2μ°¨ μ‹λ„ β”€β”€X                                         β”‚
β”‚        β”€β”€β–¶ 3μ°¨ μ‹λ„ β”€β”€X                                         β”‚
β”‚               β”‚                                                 β”‚
β”‚               β””β”€β”€β–¶ 503 + URX λ°ν™                               β”‚
β”‚                                                                 β”‚
β”‚   ν™•μΈν•  κ²ƒ:                                                    β”‚
β”‚   1. μ„λΉ„μ¤κ°€ μ‘λ‹µν•λ”κ°€?                                       β”‚
β”‚   2. κ°„ν—μ  μ¥μ• μΈκ°€?                                           β”‚
β”‚   3. Retry μ„¤μ •μ΄ μ μ ν•κ°€?                                     β”‚
β”‚                                                                 β”‚
β”‚   ν•΄κ²°:                                                         β”‚
β”‚   - μ„λΉ„μ¤ μƒνƒ μ κ²€                                            β”‚
β”‚   - Retry νμ μ΅°μ •                                             β”‚
β”‚   - κ·Όλ³Έ μ›μΈ ν•΄κ²°                                              β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### DC (Downstream Connection Termination)

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   DC - Downstream Connection Termination                        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚   μ›μΈ: ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°μ„ λμ                                β”‚
β”‚                                                                 β”‚
β”‚   ν΄λΌμ΄μ–ΈνΈ β”€β”€β–¶ μ”μ²­ β”€β”€β–¶ μ²λ¦¬ μ¤‘...                            β”‚
β”‚       β”‚                                                         β”‚
β”‚       β””β”€β”€ (μ—°κ²° λμ) β”€β”€X                                       β”‚
β”‚                                                                 β”‚
β”‚   ν™•μΈν•  κ²ƒ:                                                    β”‚
β”‚   1. ν΄λΌμ΄μ–ΈνΈ νƒ€μ„μ•„μ›ƒ μ„¤μ •                                   β”‚
β”‚   2. λ„¤νΈμ›ν¬ λ¶μ•μ •                                            β”‚
β”‚   3. λ΅λ“λ°Έλ°μ„ νƒ€μ„μ•„μ›ƒ                                        β”‚
β”‚                                                                 β”‚
β”‚   ν•΄κ²°:                                                         β”‚
β”‚   - ν΄λΌμ΄μ–ΈνΈ νƒ€μ„μ•„μ›ƒ μ¦κ°€                                    β”‚
β”‚   - μ„λ²„ μ‘λ‹µ μ‹κ°„ λ‹¨μ¶•                                         β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## π› οΈ λ΅κ·Έ λ¶„μ„ μ‹¤μ „

### λ΅κ·Έ μ΅°ν

```bash
# νΉμ • Podμ Access Log
$ kubectl logs deploy/my-app -c istio-proxy -f | grep "response_flags"

# JSON νμ‹± (jq μ‚¬μ©)
$ kubectl logs deploy/my-app -c istio-proxy | jq 'select(.response_code >= 500)'

# νΉμ • Response Flag ν•„ν„°
$ kubectl logs deploy/my-app -c istio-proxy | jq 'select(.response_flags == "UO")'
```

### μ—λ¬ ν¨ν„΄ λ¶„μ„

```bash
# Response Flagλ³„ μΉ΄μ΄νΈ
$ kubectl logs deploy/my-app -c istio-proxy | \
    jq -r '.response_flags' | sort | uniq -c | sort -rn

# μμƒ μ¶λ ¥
# 1234 -
#   45 UO
#   12 UF
#    3 NR

# μƒνƒ μ½”λ“λ³„ μΉ΄μ΄νΈ
$ kubectl logs deploy/my-app -c istio-proxy | \
    jq -r '.response_code' | sort | uniq -c | sort -rn
```

### λλ¦° μ”μ²­ μ°ΎκΈ°

```bash
# μ‘λ‹µ μ‹κ°„μ΄ 1μ΄ μ΄μƒμΈ μ”μ²­
$ kubectl logs deploy/my-app -c istio-proxy | \
    jq 'select(.duration > 1000)'

# κ°€μ¥ λλ¦° μ”μ²­ Top 10
$ kubectl logs deploy/my-app -c istio-proxy | \
    jq -s 'sort_by(-.duration) | .[0:10]'
```

---

## π“ μ»¤μ¤ν…€ λ΅κ·Έ ν¬λ§·

### κΈ°λ³Έ ν¬λ§· ν™•μ¥

```yaml
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  meshConfig:
    accessLogFile: /dev/stdout
    accessLogEncoding: JSON
    accessLogFormat: |
      {
        "start_time": "%START_TIME%",
        "method": "%REQ(:METHOD)%",
        "path": "%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%",
        "protocol": "%PROTOCOL%",
        "response_code": "%RESPONSE_CODE%",
        "response_flags": "%RESPONSE_FLAGS%",
        "bytes_received": "%BYTES_RECEIVED%",
        "bytes_sent": "%BYTES_SENT%",
        "duration": "%DURATION%",
        "upstream_service_time": "%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%",
        "x_forwarded_for": "%REQ(X-FORWARDED-FOR)%",
        "user_agent": "%REQ(USER-AGENT)%",
        "request_id": "%REQ(X-REQUEST-ID)%",
        "authority": "%REQ(:AUTHORITY)%",
        "upstream_host": "%UPSTREAM_HOST%",
        "upstream_cluster": "%UPSTREAM_CLUSTER%",
        "route_name": "%ROUTE_NAME%",
        "trace_id": "%REQ(X-B3-TRACEID)%",
        "user_id": "%REQ(X-USER-ID)%"
      }
```

### μ£Όμ” ν¬λ§· λ³€μ

| λ³€μ | μ„¤λ… |
|------|------|
| `%START_TIME%` | μ”μ²­ μ‹μ‘ μ‹κ°„ |
| `%DURATION%` | μ΄ μ²λ¦¬ μ‹κ°„ (ms) |
| `%RESPONSE_CODE%` | HTTP μƒνƒ μ½”λ“ |
| `%RESPONSE_FLAGS%` | Response Flags |
| `%UPSTREAM_HOST%` | μ‹¤μ  μ—°κ²°λ μ„λ²„ IP |
| `%UPSTREAM_CLUSTER%` | μ—°κ²°λ ν΄λ¬μ¤ν„° μ΄λ¦„ |
| `%REQ(ν—¤λ”)%` | μ”μ²­ ν—¤λ” κ°’ |
| `%RESP(ν—¤λ”)%` | μ‘λ‹µ ν—¤λ” κ°’ |

---

## π” λ¬Έμ  μ§„λ‹¨ μ²΄ν¬λ¦¬μ¤νΈ

### 503 μ—λ¬ μ§„λ‹¨

```
1. Response Flags ν™•μΈ
   β”β”€β”€ UO β†’ Connection Pool μ„¤μ • ν™•μΈ
   β”β”€β”€ UF β†’ μ„λΉ„μ¤ μƒνƒ ν™•μΈ
   β”β”€β”€ URX β†’ Retry μ„¤μ • + μ„λΉ„μ¤ μƒνƒ
   β””β”€β”€ NR β†’ VirtualService/Service ν™•μΈ

2. μƒμ„Έ λ¶„μ„
   $ kubectl logs deploy/<app> -c istio-proxy | jq 'select(.response_code == 503)'

3. κ΄€λ ¨ λ¦¬μ†μ¤ ν™•μΈ
   $ kubectl get pods -l app=<app>
   $ kubectl get svc <app>
   $ kubectl get vs <app>
   $ kubectl get dr <app>
```

### 504 μ—λ¬ μ§„λ‹¨

```
1. νƒ€μ„μ•„μ›ƒ μ„μΉ ν™•μΈ
   β”β”€β”€ DT β†’ ν΄λΌμ΄μ–ΈνΈ νƒ€μ„μ•„μ›ƒ
   β”β”€β”€ UT β†’ VirtualService timeout
   β””β”€β”€ - + 504 β†’ μ—…μ¤νΈλ¦Ό μ„λΉ„μ¤ νƒ€μ„μ•„μ›ƒ

2. νƒ€μ„μ•„μ›ƒ μ„¤μ • ν™•μΈ
   $ kubectl get vs <app> -o yaml | grep timeout

3. μ„λΉ„μ¤ μ‘λ‹µ μ‹κ°„ ν™•μΈ
   $ kubectl logs deploy/<app> -c istio-proxy | jq '.duration' | sort -n | tail
```

### μ—°κ²° λκΉ€ μ§„λ‹¨

```
1. Response Flags ν™•μΈ
   β”β”€β”€ DC β†’ ν΄λΌμ΄μ–ΈνΈκ°€ λμ
   β”β”€β”€ UC β†’ μ„λ²„κ°€ λμ
   β””β”€β”€ LR β†’ Envoyκ°€ λ¦¬μ…‹

2. μ›μΈ λ¶„μ„
   - DC: ν΄λΌμ΄μ–ΈνΈ νƒ€μ„μ•„μ›ƒ ν™•μΈ
   - UC: μ„λ²„ μΈ΅ μ—°κ²° μ μ§€ μ„¤μ • ν™•μΈ
   - LR: Envoy μ„¤μ • ν™•μΈ
```

---

## π“ λ΅κ·Έ λ¨λ‹ν„°λ§ μ•„ν‚¤ν…μ²

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                   λ΅κ·Έ μμ§‘ μ•„ν‚¤ν…μ²                            β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”           β”‚
β”‚   β”‚    Pod A    β”‚   β”‚    Pod B    β”‚   β”‚    Pod C    β”‚           β”‚
β”‚   β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”  β”‚   β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”  β”‚   β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”  β”‚           β”‚
β”‚   β”‚  β”‚Sidecarβ”‚  β”‚   β”‚  β”‚Sidecarβ”‚  β”‚   β”‚  β”‚Sidecarβ”‚  β”‚           β”‚
β”‚   β”‚  β”‚(Envoy)β”‚  β”‚   β”‚  β”‚(Envoy)β”‚  β”‚   β”‚  β”‚(Envoy)β”‚  β”‚           β”‚
β”‚   β”‚  β””β”€β”€β”€β”¬β”€β”€β”€β”  β”‚   β”‚  β””β”€β”€β”€β”¬β”€β”€β”€β”  β”‚   β”‚  β””β”€β”€β”€β”¬β”€β”€β”€β”  β”‚           β”‚
β”‚   β””β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”   β””β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”   β””β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”           β”‚
β”‚          β”‚                 β”‚                 β”‚                  β”‚
β”‚          β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                  β”‚
β”‚                           β”‚ stdout                              β”‚
β”‚                           β–Ό                                     β”‚
β”‚   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚   β”‚              Fluentd / Fluent Bit                   β”‚       β”‚
β”‚   β”‚              (Node-level collector)                 β”‚       β”‚
β”‚   β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚                             β”‚                                   β”‚
β”‚                             β–Ό                                   β”‚
β”‚   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚   β”‚              Elasticsearch / Loki                   β”‚       β”‚
β”‚   β”‚              (λ΅κ·Έ μ €μ¥μ†)                          β”‚       β”‚
β”‚   β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚                             β”‚                                   β”‚
β”‚                             β–Ό                                   β”‚
β”‚   β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚   β”‚              Kibana / Grafana                       β”‚       β”‚
β”‚   β”‚              (μ‹κ°ν™”)                               β”‚       β”‚
β”‚   β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## π“ μ •λ¦¬

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                 Access Log μ²΄ν¬λ¦¬μ¤νΈ                           β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                 β”‚
β”‚   β… μ„¤μ •                                                       β”‚
β”‚      β–΅ Access Log ν™μ„±ν™”                                        β”‚
β”‚      β–΅ JSON ν•μ‹ κ¶μ¥                                           β”‚
β”‚      β–΅ ν•„μ”ν• ν•„λ“ ν¬ν•¨                                         β”‚
β”‚                                                                 β”‚
β”‚   β… Response Flags μ™μ§€                                        β”‚
β”‚      β–΅ UO: Connection Pool                                      β”‚
β”‚      β–΅ UF: μ—°κ²° μ‹¤ν¨                                            β”‚
β”‚      β–΅ NR: λΌμ°νΈ μ—†μ                                          β”‚
β”‚      β–΅ URX: μ¬μ‹λ„ μ΄κ³Ό                                         β”‚
β”‚      β–΅ DC/UC: μ—°κ²° λκΉ€                                         β”‚
β”‚                                                                 β”‚
β”‚   β… λ¨λ‹ν„°λ§                                                   β”‚
β”‚      β–΅ Response Flags μ•λ¦Ό μ„¤μ •                                 β”‚
β”‚      β–΅ λλ¦° μ”μ²­ μ¶”μ                                            β”‚
β”‚      β–΅ λ΅κ·Έ μμ§‘ νμ΄ν”„λΌμΈ κµ¬μ¶•                                β”‚
β”‚                                                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## π― ν•µμ‹¬ μ •λ¦¬

| Response Flag | μλ―Έ | ν™•μΈν•  κ²ƒ |
|---------------|------|----------|
| `-` | μ •μƒ | - |
| `UO` | Circuit Breaker | DestinationRule connectionPool |
| `UF` | μ—°κ²° μ‹¤ν¨ | Pod μƒνƒ, Service |
| `NR` | λΌμ°νΈ μ—†μ | VirtualService, Service |
| `URX` | μ¬μ‹λ„ μ΄κ³Ό | μ„λΉ„μ¤ μƒνƒ, Retry μ„¤μ • |
| `DC` | ν΄λΌμ΄μ–ΈνΈ λμ | ν΄λΌμ΄μ–ΈνΈ νƒ€μ„μ•„μ›ƒ |

---

## π”— λ‹¤μ νΈ μκ³ 

Part 4μ—μ„λ” **Kiali**λ¥Ό λ‹¤λ£Ήλ‹λ‹¤:
- Service Mesh μ‹κ°ν™”
- Service Graph
- μ„¤μ • κ²€μ¦

---

## π”— μ°Έκ³  μλ£

- [Istio Access Logging](https://istio.io/latest/docs/tasks/observability/logs/access-log/)
- [Envoy Access Log Format](https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage)
- [Response Flags](https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#config-access-log-format-response-flags)
